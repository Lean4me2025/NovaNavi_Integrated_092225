<!doctype html>
<html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NOVA • Traits</title>
<style>
:root{ --bg:#081B33; --panel:#0B2347cc; --panel2:#0F2B57; --accent:#FDBA21; --text:#fff; }
*{box-sizing:border-box}
html,body{height:100%}
body{ margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1000px 600px at 20% 0%, #0e3269 0%, var(--bg) 55%); color:var(--text); }
.wrap{max-width:1100px;margin:2.5rem auto;padding:0 1rem}
.card{background:var(--panel);border-radius:14px;padding:1.25rem;margin:1rem 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
.btn{padding:.6rem 1rem;border-radius:10px;border:0;cursor:pointer;font-weight:700}
.btn.primary{background:var(--accent);color:#111}
.btn.ghost{background:transparent;border:1px solid #ffffff55;color:#fff}
.small{font-size:.95rem;opacity:.9}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.tile{padding:14px;border-radius:10px;border:1px solid #ffffff22;cursor:pointer;text-align:center;user-select:none}
.tile.selected{outline:3px solid rgba(253,186,33,0.45);box-shadow:0 6px 20px rgba(11,35,71,0.6)}
.bar{display:flex;align-items:center;justify-content:space-between;margin-top:1rem}
.controls{display:flex;gap:8px;align-items:center}
/* Safety: class alone should NOT block clicks */
button.disabled:not([disabled]){pointer-events:auto;opacity:1}
/* When actually disabled, block */
button[disabled]{pointer-events:none;opacity:.6}
</style>
</head>
<body>
  <div class="wrap">
    <header class="header"><div><strong>NOVA • Trait Selection</strong></div><nav><a href="index.html">Home</a> • <a href="navi-settings.html">Settings</a></nav></header>
    <section class="card">
      <h2>Select your top traits</h2>
      <p class="small">Pick at least <strong id="minReq">5</strong> traits.</p>

      <div style="margin-top:1rem;">
        <button id="clearBtn" class="btn ghost">Clear selections</button>
      </div>

      <div class="grid" id="traitsGrid" style="margin-top:1rem;"></div>

      <div class="bar">
        <div><span id="selectedCount">0</span> selected</div>
        <div class="controls">
          <button id="seeResultsBtn" class="btn primary disabled" disabled>See My Results</button>
          <button id="backBtn" class="btn ghost">← Back</button>
        </div>
      </div>
    </section>
  </div>

<script>
const MIN_TRAITS = 5;
const TRAIT_LIST = [
"Communicator","Resilient","Initiative-Taker","Organized","Curious","Mentor","Visionary","Data-Driven",
"Customer-Focused","Results-Oriented","Ethical","Calm Under Pressure","Decision-Maker","Learner","Persistent",
"Relationship-Builder","Presenter","Planner","Entrepreneurial","Systems Thinker","Resourceful","Independent",
"Team Player","Inclusive","Diplomatic","Optimistic","Accountable","Thorough","Fast Learner","Self-Starter",
"Process-Oriented","Quality-Focused","Storyteller","Technical","Numerical","Design Thinker","Researcher","Teacher",
"Negotiator","Servant-Hearted"
];

const grid = document.getElementById('traitsGrid');
const countEl = document.getElementById('selectedCount');
const seeBtn = document.getElementById('seeResultsBtn');
const clearBtn = document.getElementById('clearBtn');
const backBtn = document.getElementById('backBtn');

// Render fresh tiles every load -> prevents bfcache pre-selected ghosts
function renderTiles(){
  grid.innerHTML = '';
  TRAIT_LIST.forEach(name => {
    const d = document.createElement('div');
    d.className = 'tile';
    d.setAttribute('data-trait', name);
    d.textContent = name;
    grid.appendChild(d);
  });
}
renderTiles();

// Ensure no stale state on arrival (always start clean)
function hardReset(){
  localStorage.removeItem('novaSelectedTraits');
  Array.from(document.querySelectorAll('.tile')).forEach(el => el.classList.remove('selected'));
  updateUI();
}
hardReset();

// Event delegation for robust binding
grid.addEventListener('click', (e) => {
  const tile = e.target.closest('.tile');
  if(!tile) return;
  tile.classList.toggle('selected');
  saveFromDOM();
  updateUI();
}, {passive:true});

// Clear button
clearBtn.addEventListener('click', () => {
  Array.from(document.querySelectorAll('.tile.selected')).forEach(el => el.classList.remove('selected'));
  saveFromDOM();
  updateUI();
});

// Back
backBtn.addEventListener('click', ()=> window.location.href='index.html');

// Compute selected from DOM to avoid Set desync
function selectedCountFromDOM(){
  return document.querySelectorAll('.tile.selected').length;
}
function selectedArrayFromDOM(){
  return Array.from(document.querySelectorAll('.tile.selected')).map(el => el.getAttribute('data-trait'));
}
function saveFromDOM(){
  const arr = selectedArrayFromDOM();
  localStorage.setItem('novaSelectedTraits', JSON.stringify(arr));
}

function updateUI(){
  const n = selectedCountFromDOM();
  countEl.textContent = String(n);
  if(n >= MIN_TRAITS){
    seeBtn.removeAttribute('disabled');
    seeBtn.classList.remove('disabled');
    seeBtn.setAttribute('aria-disabled','false');
    seeBtn.style.pointerEvents = 'auto';
  } else {
    seeBtn.setAttribute('disabled','true');
    seeBtn.classList.add('disabled');
    seeBtn.setAttribute('aria-disabled','true');
  }
}

// Results navigation
seeBtn.addEventListener('click', (e) => {
  if(selectedCountFromDOM() < MIN_TRAITS){
    e.preventDefault();
    return;
  }
  saveFromDOM();
  window.location.href = 'results.html';
});

// Also handle bfcache restore -> re-evaluate UI
window.addEventListener('pageshow', (e) => {
  updateUI();
});
</script>
</body></html>
